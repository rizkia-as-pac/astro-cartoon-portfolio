---
import { Fragment } from "astro/jsx-runtime";
import { siteConfig } from "../config/site";

const base = import.meta.env.BASE_URL;
const withBase = (path: string) => `${base}${path.replace(/^\//, "")}`;
const isExternalUrl = (href: string) => /^https?:\/\//i.test(href);

const avatarSrc =
  siteConfig.hero.avatar
    ? (isExternalUrl(siteConfig.hero.avatar)
        ? siteConfig.hero.avatar
        : siteConfig.hero.avatar.startsWith("/")
          ? withBase(siteConfig.hero.avatar)
          : siteConfig.hero.avatar)
    : "";
---

<section class="hero-section">
  <div class="hero-content-wrapper page-content">
    <div class="hero-left-col hero-content-animate">
      <p class="hero-normal-text">{siteConfig.hero.prefix}</p>
      <h1 class="hero-big-text">{siteConfig.hero.name}</h1>

      <p class="hero-intro-text">
        {siteConfig.hero.intro.split("\n").map((line, i, arr) => (
          <Fragment>
            {line}
            {i < arr.length - 1 && <br />}
          </Fragment>
        ))}
      </p>

      <div class="hero-btn-row">
        <a href={withBase("/posts")} class="hero-btn">
          {siteConfig.hero.buttons.viewPosts}
        </a>
        <a href={withBase("/contact")} class="hero-btn-alt">
          {siteConfig.hero.buttons.contactMe}
        </a>
      </div>
    </div>

    <div class="hero-right-col">
      {avatarSrc && (
        <img
          src={avatarSrc}
          alt="avatar"
          class="hero-avatar hero-avatar-animate"
          loading="lazy"
        />
      )}

      <div class="social-list">
        {siteConfig.hero.socialLinks.map((social) => {
          const isExternal = isExternalUrl(social.url);
          const iconSrc =
            social.icon
              ? (isExternalUrl(social.icon)
                  ? social.icon
                  : social.icon.startsWith("/")
                    ? withBase(social.icon)
                    : social.icon)
              : "";

          return (
            <a
              href={social.url}
              class="social-icon-btn social-icon-animate"
              aria-label={social.name}
              target={isExternal ? "_blank" : undefined}
              rel={isExternal ? "noopener noreferrer" : undefined}
            >
              {iconSrc && <img src={iconSrc} alt={social.name.toLowerCase()} loading="lazy" />}
            </a>
          );
        })}
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const pageContent = document.querySelector(".page-content");
    if (pageContent) requestAnimationFrame(() => pageContent.classList.add("visible"));

    const heroContent = document.querySelector(".hero-content-animate");
    if (heroContent) requestAnimationFrame(() => heroContent.classList.add("visible"));

    const heroAvatar = document.querySelector(".hero-avatar-animate");
    if (heroAvatar) requestAnimationFrame(() => heroAvatar.classList.add("visible"));

    const socialIcons = document.querySelectorAll(".social-icon-animate");
    socialIcons.forEach((icon) => requestAnimationFrame(() => icon.classList.add("visible")));
  });
</script>

