---
import "../styles/navigation.css";
import { siteConfig } from "../config/site";

const base = import.meta.env.BASE_URL;
const currentPath = Astro.url.pathname;

const withBase = (path: string) => `${base}${path.replace(/^\//, "")}`;
const isActive = (path: string) => currentPath === withBase(path);
const isActivePrefix = (path: string) => currentPath.startsWith(withBase(path));
---

<nav class="navbar">
  <div class="nav-left">
    <button class="nav-toggle" aria-label="Open navigation">
      ☰
    </button>

    <a href={withBase("/")} class="site-name">
      {siteConfig.name}
    </a>
  </div>

  <ul class="nav-menu">
    <!-- tombol tutup (hanya muncul di mobile) -->
    <li class="nav-close-wrapper">
      <button class="nav-close" aria-label="Close navigation">
        ✕
      </button>
    </li>

    <li>
      <a href={withBase("/")} class={`menu-link ${isActive("/") ? "active" : ""}`}>
        {siteConfig.navigation.home}
      </a>
    </li>

    <li>
      <a
        href={withBase("/projects")}
        class={`menu-link ${isActivePrefix("/projects") ? "active" : ""}`}
      >
        {siteConfig.navigation.projects}
      </a>
    </li>

    <li>
      <a
        href={withBase("/posts")}
        class={`menu-link ${isActivePrefix("/posts") ? "active" : ""}`}
      >
        {siteConfig.navigation.posts}
      </a>
    </li>

    <li>
      <a
        href={withBase("/contact")}
        class={`menu-link ${isActivePrefix("/contact") ? "active" : ""}`}
      >
        {siteConfig.navigation.contact}
      </a>
    </li>

    <li>
      <a
        href={withBase("/comments")}
        class={`menu-link ${isActivePrefix("/comments") ? "active" : ""}`}
      >
        {siteConfig.navigation.comments}
      </a>
    </li>

    <li>
      {(() => {
        const resumeHref = siteConfig.resume || "";
        const isExternal = /^https?:\/\//i.test(resumeHref);
        const href = isExternal ? resumeHref : withBase(resumeHref || "/resume");

        return (
          <a
            href={href}
            target={isExternal ? "_blank" : undefined}
            rel={isExternal ? "noopener noreferrer" : undefined}
            class={`menu-link ${!isExternal && isActivePrefix("/resume") ? "active" : ""}`}
          >
            {siteConfig.navigation.resume}
          </a>
        );
      })()}
    </li>
  </ul>
</nav>

<script>
  const toggle = document.querySelector(".nav-toggle");
  const closeBtn = document.querySelector(".nav-close");
  const menu = document.querySelector(".nav-menu");

  toggle?.addEventListener("click", () => {
    menu?.classList.add("open");
  });

  closeBtn?.addEventListener("click", () => {
    menu?.classList.remove("open");
  });
</script>

